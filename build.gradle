//---- ğŸ”Œ í”ŒëŸ¬ê·¸ì¸ ì„¤ì • ----
plugins {
    id 'java'
    id 'org.springframework.boot' version "${springBootVersion}"
    id 'io.spring.dependency-management' version "${gradleDependencyManagementVersion}"
    id 'checkstyle'
}

//---- ğŸ“¦ ëª¨ë“  í•˜ìœ„ í”„ë¡œì íŠ¸ ê³µí†µ ì„¤ì • ----
allprojects {
    apply plugin: 'java'
    apply plugin: 'checkstyle'
    apply plugin: 'io.spring.dependency-management'

    java {
        sourceCompatibility = JavaVersion.valueOf("VERSION_${javaVersion}")
        targetCompatibility = JavaVersion.valueOf("VERSION_${javaVersion}")
    }

    group = 'com.c4cometrue'
    version = version

    repositories {
        mavenCentral()
    }

    // ğŸ“ Checkstyle ì„¤ì •
    checkstyle {
        configFile = file("${rootDir}/naver-checkstyle.xml")
        configProperties = ["suppressionFile": "${rootDir}/naver-checkstyle-suppressions.xml"]
        toolVersion = checkstyleVersion
    }

    // âœ… í…ŒìŠ¤íŠ¸ ì„¤ì •
    tasks.withType(Test) {
        useJUnitPlatform()
    }
}

subprojects {
    dependencies {
        // Core Spring Boot Dependencies
        implementation "org.springframework.boot:spring-boot-starter-data-jpa:${springBootVersion}"
        implementation "org.springframework.boot:spring-boot-starter-web:${springBootVersion}"
        implementation "org.springframework.boot:spring-boot-starter-validation:${springBootVersion}"
        implementation "org.springframework.retry:spring-retry:${springRetryVersion}"

        // QueryDSL - ëŒ€ë¶€ë¶„ì˜ ëª¨ë“ˆì—ì„œ ì‚¬ìš©
        implementation "com.querydsl:querydsl-jpa:${querydslVersion}:jakarta"
        annotationProcessor "com.querydsl:querydsl-apt:${querydslVersion}:jakarta"
        annotationProcessor "jakarta.annotation:jakarta.annotation-api:${jakartaAnnotationVersion}"
        annotationProcessor "jakarta.persistence:jakarta.persistence-api:${jakartaPersistenceVersion}"

        // Lombok - ëª¨ë“  ëª¨ë“ˆì—ì„œ ì‚¬ìš©
        compileOnly "org.projectlombok:lombok:${lombokVersion}"
        annotationProcessor "org.projectlombok:lombok:${lombokVersion}"

        // DB
        runtimeOnly "mysql:mysql-connector-java:${mysqlVersion}"
        runtimeOnly "com.oracle.database.jdbc:ojdbc8:${oracleVersion}"
    }
}

//---- ğŸŒŸ Domain Layer ----
project(':member-module') {
    dependencies {
        implementation project(':common-module')
    }
}

project(':main-account-module') {
    dependencies {
        implementation project(':member-module')
        implementation project(':common-module')
    }
}

project(':saving-account-module') {
    dependencies {
        implementation project(':main-account-module')
        implementation project(':member-module')
        implementation project(':common-module')
    }
}

project(':settlement-module') {
    dependencies {
        implementation project(':common-module')
    }
}

project(':transfer-module') {
    dependencies {
        implementation project(':member-module')
        implementation project(':main-account-module')
        implementation project(':saving-account-module')
        implementation project(':common-module')
    }
}

project(':transfer-log-module') {
    dependencies {
        implementation project(':common-module')
    }
}

project(':reminder-module') {
    dependencies {
        implementation project(':member-module')
        implementation project(':transfer-module')
        implementation project(':common-module')
    }
}

//---- ğŸŒ Interface Layer ----
project(':interface-module') {
    dependencies {
        // swagger
        implementation "org.springdoc:springdoc-openapi-starter-webmvc-ui:${springdocVersion}"

        // Test Dependencies
        testImplementation 'org.springframework.boot:spring-boot-starter-test'
        testImplementation 'org.junit.jupiter:junit-jupiter-api'
        testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine'

        // AssertJ for fluent assertions
        testImplementation 'org.assertj:assertj-core:3.24.2'

        // Mapper
        implementation "org.mapstruct:mapstruct:${mapstructVersion}"
        annotationProcessor "org.mapstruct:mapstruct-processor:${mapstructVersion}"

        implementation project(':main-account-module')
        implementation project(':member-module')
        implementation project(':reminder-module')
        implementation project(':saving-account-module')
        implementation project(':settlement-module')
        implementation project(':transfer-module')
        implementation project(':transfer-log-module')
        implementation project(':common-module')
    }
}

project(':batch-module') {
    dependencies {
        implementation project(':interface-module')
        implementation "org.springframework.boot:spring-boot-starter-batch:${springBootVersion}"
    }
}

//---- ğŸ“š Common Layer ----
project(':common-module') {
    dependencies {
        // Core Dependencies
        implementation 'org.springframework.boot:spring-boot-starter-aop'
        implementation "com.fasterxml.jackson.core:jackson-annotations:${jacksonVersion}"
    }
}

//---- QueryDSL ----
def querydslDir = "src/main/generated"

tasks.withType(JavaCompile) {
    options.compilerArgs += "-parameters"
    options.getGeneratedSourceOutputDirectory().set(file(querydslDir))
}



sourceSets {
    main.java.srcDirs += [querydslDir]
}

clean {
    delete file(querydslDir)
}
