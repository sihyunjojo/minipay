//---- ğŸ“¦ ëª¨ë“  í•˜ìœ„ í”„ë¡œì íŠ¸ ê³µí†µ ì„¤ì • ----
allprojects {
    apply plugin: 'java'
    apply plugin: 'jacoco'
    apply plugin: 'checkstyle'
    apply plugin: 'org.sonarqube'
    apply plugin: 'org.springframework.boot'
    apply plugin: 'io.spring.dependency-management'

    java {
        sourceCompatibility = JavaVersion.VERSION_17 // ìë°” ì†ŒìŠ¤ í˜¸í™˜ ë²„ì „ ì§€ì •
        targetCompatibility = JavaVersion.VERSION_17 // ë°”ì´íŠ¸ì½”ë“œ íƒ€ê²Ÿ JVM ë²„ì „ ì§€ì •
    }

    group = 'com.c4cometrue' // ê³µí†µ group ì„¤ì • (Java íŒ¨í‚¤ì§€ ê¸°ì¤€)
    version = '0.0.1-SNAPSHOT' // ê³µí†µ ë²„ì „ ì„¤ì •

    repositories {
        mavenCentral() // ëª¨ë“  ëª¨ë“ˆì—ì„œ ì‚¬ìš©í•  ì¤‘ì•™ ì €ì¥ì†Œ ì„ ì–¸
    }

    // ğŸ“ Checkstyle ì„¤ì •: ì½”ë“œ ìŠ¤íƒ€ì¼ ê·œì¹™ ë° ì˜ˆì™¸ ì²˜ë¦¬ íŒŒì¼ ì§€ì •
    checkstyle {
        configFile = file("${rootDir}/naver-checkstyle.xml") // ì½”ë“œ ìŠ¤íƒ€ì¼ ë£°ì…‹
        configProperties = ["suppressionFile": "${rootDir}/naver-checkstyle-suppressions.xml"] // ì˜ˆì™¸ ê·œì¹™ ì§€ì •
        toolVersion = "9.2" // Checkstyle ë„êµ¬ ë²„ì „ ì§€ì •
    }

    // âœ… í…ŒìŠ¤íŠ¸ ì„¤ì • ë° ì»¤ë²„ë¦¬ì§€ ë¦¬í¬íŠ¸ ì—°ê²°
    tasks.withType(Test).configureEach {
        useJUnitPlatform() // JUnit 5 í”Œë«í¼ ì‚¬ìš©
        finalizedBy 'jacocoTestReport' // í…ŒìŠ¤íŠ¸ í›„ JaCoCo ë¦¬í¬íŠ¸ ìë™ ìƒì„±
    }

    // ğŸ“Š JaCoCo ë¦¬í¬íŠ¸ ì„¤ì •
    jacocoTestReport {
        reports {
            xml.required = true // SonarQubeì—ì„œ ì‚¬ìš©ë  XML ë¦¬í¬íŠ¸ í™œì„±í™”
        }
    }
}

//---- ğŸ§© ëª¨ë“  í•˜ìœ„ ëª¨ë“ˆ(subprojects)ì— ì ìš©í•  ë¹Œë“œ ì„¤ì • ----
subprojects {

    dependencies {
        implementation 'org.springframework.boot:spring-boot-starter-web'
        testImplementation 'org.springframework.boot:spring-boot-starter-test'
    }


}

//---- âš™ï¸ ë£¨íŠ¸ì—ì„œ ì‚¬ìš©í•  ë¹Œë“œìŠ¤í¬ë¦½íŠ¸ classpath ì„¤ì • (í”ŒëŸ¬ê·¸ì¸ ì‚¬ìš©ì„ ìœ„í•¨) ----
//Gradle ìì²´ê°€ ì‘ë™í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬(í”ŒëŸ¬ê·¸ì¸ ë“±)ì„ ì–´ë””ì„œ ë°›ì„ì§€ ì •ì˜
buildscript {
    ext {
        springBootVersion = '3.1.4' // Spring Boot ë²„ì „ ë³€ìˆ˜ë¡œ ì¶”ì¶œ (ì¤‘ë³µ ë°©ì§€)
    }
    repositories {
        mavenCentral() // Maven ì €ì¥ì†Œ ì„ ì–¸
        gradlePluginPortal() // ğŸ’¡ Gradle Plugin Portal: SonarQube í”ŒëŸ¬ê·¸ì¸ ë“±ì„ ìœ„í•´ í•„ìˆ˜
    }
    dependencies {
        // ë£¨íŠ¸ ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì‚¬ìš©í•  í´ë˜ìŠ¤íŒ¨ìŠ¤ ì˜ì¡´ì„± ì„ ì–¸
        classpath("org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}")
        classpath("io.spring.gradle:dependency-management-plugin:1.1.3")
        classpath("org.sonarsource.scanner.gradle:sonarqube-gradle-plugin:4.3.1.3277")
    }
}

//---- ğŸ” SonarQube ë¶„ì„ ê¸°ëŠ¥ í™œì„±í™” ----
apply plugin: "org.sonarqube"

sonar {
    properties {
        property "sonar.projectKey", "C4-ComeTrue_c4-cometrue-assignment"
        property "sonar.organization", "c4-cometrue"
        property "sonar.host.url", "https://sonarcloud.io"
        property "sonar.coverage.jacoco.xmlReportPaths", "build/reports/jacoco/test/jacocoTestReport.xml"
        property "sonar.java.checkstyle.reportPaths", "build/reports/checkstyle/main.xml"
    }
}


//todo: ì™œ ì´ë ‡ê²Œ ë°”ë€ì§€ í™•ì¸.
configurations {
    compileOnly {
        extendsFrom annotationProcessor
    }
}

dependencies {
    implementation 'org.apache.commons:commons-lang3:3.13.0'
    implementation 'org.apache.commons:commons-collections4:4.4'
    compileOnly 'org.projectlombok:lombok'
    annotationProcessor 'org.projectlombok:lombok'

    // db
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
    // swagger
    implementation 'org.springdoc:springdoc-openapi-starter-webmvc-ui:2.2.0'

//  runtimeOnly 'com.h2database:h2'
//  runtimeOnly 'mysql:mysql-connector-java:8.0.33'
    runtimeOnly 'com.oracle.database.jdbc:ojdbc8:21.11.0.0'

    implementation 'com.querydsl:querydsl-jpa:5.0.0:jakarta'
    annotationProcessor "com.querydsl:querydsl-apt:5.0.0:jakarta"
    annotationProcessor "jakarta.annotation:jakarta.annotation-api"
    annotationProcessor "jakarta.persistence:jakarta.persistence-api"

    implementation project(':common-module')
    implementation project(':api-module')
}

checkstyle {
    configFile = file("${rootDir}/naver-checkstyle.xml")
    configProperties = ["suppressionFile": "${rootDir}/naver-checkstyle-suppressions.xml"]
    toolVersion = "9.2"
}

tasks.named('test') {
    useJUnitPlatform()
    finalizedBy 'jacocoTestReport'
}

jacocoTestReport {
    reports {
        xml.required = true
    }
}

sonar {
    properties {
        property "sonar.projectKey", "C4-ComeTrue_c4-cometrue-assignment"
        property "sonar.organization", "c4-cometrue"
        property "sonar.host.url", "https://sonarcloud.io"
        property "sonar.coverage.jacoco.xmlReportPaths", "build/reports/jacoco/test/jacocoTestReport.xml"
        property "sonar.java.checkstyle.reportPaths", "build/reports/checkstyle/main.xml"
    }
}


// queryDSL
def querydslDir = "src/main/generated"

tasks.withType(JavaCompile) {
    options.compilerArgs += "-parameters"
    options.getGeneratedSourceOutputDirectory().set(file(querydslDir))
}

sourceSets {
    main.java.srcDirs += [querydslDir]
}

clean {
    delete file(querydslDir)
}

